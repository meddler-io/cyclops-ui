{"options":{"viewOn":"devsecops_scandata","pipeline":[{"$lookup":{"localField":"_id","foreignField":"businessId","as":"project","from":"business"}},{"$unwind":"$project"},{"$lookup":{"let":{"business":"$_id","project":"$project._id"},"pipeline":[{"$match":{"$expr":{"$and":[{"$eq":["$businessId","$$business"]},{"$eq":["$projectId","$$project"]}]}}}],"as":"result","from":"customer_bucket"}},{"$unwind":"$result"},{"$lookup":{"from":"menu","localField":"result.parentId","foreignField":"_id","as":"menu"}},{"$match":{"menu.type":"platform"}},{"$unwind":"$menu"},{"$project":{"businessName":"$name","projectId":"$project._id","projectName":"$project.name","platformId":"$menu._id","platformName":"$menu.name","applicationId":"$result._id","applicationName":"$result.name","businessId":"$_id"}},{"$lookup":{"from":"devsecops_scandata","let":{"project":"$projectId","platform":"$platformId","application":"$applicationId","business":"$businessId"},"pipeline":[{"$match":{"$expr":{"$and":[{"$eq":["$businessId","$$business"]},{"$eq":["$projectId","$$project"]},{"$eq":["$platformId","$$platform"]},{"$eq":["$applicationId","$$application"]}]}}}],"as":"scan_data"}},{"$lookup":{"let":{"business":"$businessId","project":"$projectId","platform":"$platformId","application":"$applicationId"},"pipeline":[{"$match":{"$expr":{"$and":[{"$eq":["$businessId","$$business"]},{"$eq":["$projectId","$$project"]},{"$eq":["$platformId","$$platform"]},{"$eq":["$applicationId","$$application"]}]}}}],"as":"build_data","from":"devsecops"}},{"$unwind":{"path":"$scan_data","preserveNullAndEmptyArrays":true}},{"$unwind":{"path":"$build_data","preserveNullAndEmptyArrays":true}},{"$sort":{"projectName":{"$numberInt":"1"},"platformName":{"$numberInt":"1"},"applicationName":{"$numberInt":"1"},"build_data._id":{"$numberInt":"-1"},"businessName":{"$numberInt":"1"}}},{"$group":{"latest_build":{"$first":"$build_data"},"_id":{"platformName":"$platformName","applicationId":"$applicationId","applicationName":"$applicationName","businessId":"$businessId","businessName":"$businessName","projectId":"$projectId","projectName":"$projectName","platformId":"$platformId"},"scan_data":{"$first":"$scan_data.scan_data"},"noOfBuilds":{"$sum":{"$numberInt":"1"}}}},{"$group":{"_id":{"platformName":"$_id.platformName","businessId":"$_id.businessId","businessName":"$_id.businessName","projectId":"$_id.projectId","projectName":"$_id.projectName","platformId":"$_id.platformId"},"application":{"$addToSet":{"applicationId":"$_id.applicationId","applicationName":"$_id.applicationName","scan_data":"$scan_data","latest_build":"$latest_build","noOfBuilds":"$noOfBuilds"}}}},{"$project":{"application":"$application","projectId":"$_id.projectId","businessName":"$_id.businessName","platformName":"$_id.platformName","_id":{"$numberInt":"0"},"projectName":"$_id.projectName","expand":{"$literal":false},"businessId":"$_id.businessId","platformId":"$_id.platformId"}},{"$sort":{"platformName":{"$numberInt":"1"},"applicationName":{"$numberInt":"1"},"businessName":{"$numberInt":"1"},"projectName":{"$numberInt":"1"}}}]},"indexes":[],"collectionName":"test","type":"view"}